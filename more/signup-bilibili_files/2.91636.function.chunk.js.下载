(window.webpackJsonpwebpackLogReporter=window.webpackJsonpwebpackLogReporter||[]).push([[2],{87:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=i(r(2)),n=i(r(26));function i(e){return e&&e.__esModule?e:{default:e}}function a(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var s=function(){function e(){!function(e,t){if(!(e instanceof t))try{throw new TypeError("Cannot call a class as a function")}catch(e){}}(this,e),this.browser=o.default.myBrowser(),this.collectApiInfo(),this.collectBfsInfo()}var t,r,i;return t=e,(r=[{key:"getHeader",value:function(e,t){var r=e.getAllResponseHeaders();if(r.indexOf(t.toLowerCase())>-1){var o=new RegExp(t,"i"),n=r.match(o)[0];return e.getResponseHeader(n)}return""}},{key:"collectApiInfo",value:function(){var e=this,t=n.default.ajax({url:"//api.bilibili.com/x/web-interface/nav?from=report",cache:!0,success:function(r){var o=e.getHeader(t,"x-cache-webcdn"),n=e.getHeader(t,"x-service-module");e.reportApiCdn(o,n)}})}},{key:"collectBfsInfo",value:function(){var e=this,t=n.default.ajax({url:"//i0.hdslb.com/bfs/test/ce1cf20203c303963e78c811b01100667c960bba.png",cache:!0,noCredentials:!0,success:function(r){var o=e.getHeader(t,"x-cache-webcdn");e.reportBfsCdn(o,"")}})}},{key:"getResourceList",value:function(){return window.performance&&"function"==typeof performance.getEntriesByType?performance.getEntriesByType("resource"):[]}},{key:"reportApiCdn",value:function(e,t){var r=this;this.getResourceList().forEach(function(n){n.name.indexOf("web-interface/nav?from=report")>0&&r.todo({cdn_addr:e,protocol:t,uri:document.baseURI||window.location.href,request_uri:o.default.splitUrlArgs(n.name).path,referrer:document.referrer||"",dns_time:n.domainLookupEnd-n.domainLookupStart,connect_time:n.connectEnd-n.connectStart,request_time:n.responseStart-n.requestStart,response_time:n.responseEnd-n.responseStart,consumer_time:n.duration,request_args:o.default.splitUrlArgs(n.name).args,initiator_type:n.initiatorType,error:""},!0)})}},{key:"reportBfsCdn",value:function(e,t){var r=this;this.getResourceList().forEach(function(t){t.name.indexOf("ce1cf20203c303963e78c811b01100667c960bba")>0&&r.todo({cdn_addr:e,uri:document.baseURI||window.location.href,request_uri:o.default.splitUrlArgs(t.name).path,referrer:document.referrer||"",dns_time:t.domainLookupEnd-t.domainLookupStart,connect_time:t.connectEnd-t.connectStart,request_time:t.responseStart-t.requestStart,response_time:t.responseEnd-t.responseStart,consumer_time:t.duration,request_args:o.default.splitUrlArgs(t.name).args,initiator_type:t.initiatorType,error:""})})}},{key:"todo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,r={log_id:200001,browser:this.browser,uri:e.uri,user_agent:navigator.userAgent,mid:Number(o.default.getCookie("DedeUserID")||0),buvid:o.default.getCookie("buvid3")||"",referrer:e.referrer,extended_fields:{cdn_addr:e.cdn_addr,request_uri:e.request_uri||"",start_request_ts:(Math.floor(e.start_request_ts)||Date.parse(new Date)/1e3).toString(),dns_time:(Math.floor(e.dns_time)||"0").toString(),hit_cache:e.hit_cache||"",cdn_hostname:e.cdn_hostname||"",idc:e.idc||"",connect_time:(Math.floor(e.connect_time)||"0").toString(),request_time:("0"|Math.floor(e.request_time)).toString(),response_time:(Math.floor(e.response_time)||"0").toString(),consumer_time:(Math.floor(e.consumer_time)||"0").toString(),request_args:encodeURI(e.request_args||""),initiator_type:String.prototype.toLocaleLowerCase.call(e.initiator_type||""),error:void 0==e.error?"error":e.error}};t&&(r.extended_fields.protocol=e.protocol),n.default.sendPostRequest("//apm-misaka.biliapi.net/misaka/web/report?cross_domain=true",JSON.stringify(r))}}])&&a(t.prototype,r),i&&a(t,i),e}();t.default=s}}]);